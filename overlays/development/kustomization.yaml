apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# 1. ê³µí†µ ë¦¬ì†ŒìŠ¤(base)ë“¤ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
# - ../../base/common
resources:
- ../../base/backend
- ../../base/frontend
- secret.yaml

# 2. ì´ í™˜ê²½ì˜ ëª¨ë“  ë¦¬ì†ŒìŠ¤ì— ì ìš©í•  ë„¤ì„ìŠ¤í˜ì´ìŠ¤
namespace: default

# 3. ì´ í™˜ê²½ì˜ ëª¨ë“  ë¦¬ì†ŒìŠ¤ ì´ë¦„ì— ë¶™ì¼ ì ‘ë‘ì‚¬ (ì˜ˆ: backend -> dev-backend)
# namePrefix: dev-  # í•„ìš” ì‹œ ì£¼ì„ í•´ì œí•˜ì—¬ ì‚¬ìš©

# 4. ğŸš¨ Jenkins CIê°€ ìˆ˜ì •í•  ì´ë¯¸ì§€ íƒœê·¸ë¥¼ ìµœì¢… ì§€ì •í•©ë‹ˆë‹¤.
images:
- name: 224874704033.dkr.ecr.ap-northeast-2.amazonaws.com/my-backend
  newName: 224874704033.dkr.ecr.ap-northeast-2.amazonaws.com/my-backend
  newTag: "21"
- name: 224874704033.dkr.ecr.ap-northeast-2.amazonaws.com/my-frontend
  newName: 224874704033.dkr.ecr.ap-northeast-2.amazonaws.com/my-frontend
  newTag: "29"

# 5. baseì˜ ì„¤ì •ì„ ë®ì–´ì“¸ ë‚´ìš©(íŒ¨ì¹˜)ì„ ì •ì˜í•©ë‹ˆë‹¤.
patches:
- patch: |-
    - op: replace
      path: /spec/replicas
      value: 2
  target:
    kind: Deployment
    name: frontend
- patch: |-
    - op: replace
      path: /spec/minReplicas
      value: 2
    - op: replace
      path: /spec/maxReplicas
      value: 3
  target:
    kind: HorizontalPodAutoscaler
    name: backend-hpa
