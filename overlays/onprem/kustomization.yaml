# overlays/onprem/kustomization.yaml
##
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- ../../base/backend
- ../../base/frontend
- secret.yaml

namespace: default

images:
# --- backend 이미지 설정 ---
# 1. base의 ECR 이미지 이름을 찾아서,
- name: 224874704033.dkr.ecr.ap-northeast-2.amazonaws.com/my-backend
  # 2. 아래 Harbor 주소로 교체합니다.
  newName: harbor.ecommerce.corp/ecr-replicated/my-backend # 👈 Harbor에서 확인한 정확한 주소
  # 3. Jenkins가 이 태그를 계속해서 수정합니다.
  newTag: 56-onprem

# --- frontend 이미지 설정 ---
- name: 224874704033.dkr.ecr.ap-northeast-2.amazonaws.com/my-frontend
  newName: harbor.ecommerce.corp/ecr-replicated/my-frontend # 👈 Harbor에서 확인한 정확한 주소
  newTag: 55-onprem

patches:
- patch: |-
    - op: replace
      path: /spec/replicas
      value: 2
  target:
    kind: Deployment
    name: frontend-deployment

- patch: |-
    - op: replace
      path: /spec/minReplicas
      value: 2
    - op: replace
      path: /spec/maxReplicas
      value: 3
  target:
    kind: HorizontalPodAutoscaler
    name: backend-hpa