# overlays/onprem/kustomization.yaml
##
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- ../../base/backend
- ../../base/frontend
- secret.yaml

namespace: default

images:
# --- backend ì´ë¯¸ì§€ ì„¤ì • ---
# 1. baseì˜ ECR ì´ë¯¸ì§€ ì´ë¦„ì„ ì°¾ì•„ì„œ,
- name: 224874704033.dkr.ecr.ap-northeast-2.amazonaws.com/my-backend
  # 2. ì•„ë˜ Harbor ì£¼ì†Œë¡œ êµì²´í•©ë‹ˆë‹¤.
  newName: harbor.ecommerce.corp/ecr-replicated/my-backend # ğŸ‘ˆ Harborì—ì„œ í™•ì¸í•œ ì •í™•í•œ ì£¼ì†Œ
  # 3. Jenkinsê°€ ì´ íƒœê·¸ë¥¼ ê³„ì†í•´ì„œ ìˆ˜ì •í•©ë‹ˆë‹¤.
  newTag: 56-onprem

# --- frontend ì´ë¯¸ì§€ ì„¤ì • ---
- name: 224874704033.dkr.ecr.ap-northeast-2.amazonaws.com/my-frontend
  newName: harbor.ecommerce.corp/ecr-replicated/my-frontend # ğŸ‘ˆ Harborì—ì„œ í™•ì¸í•œ ì •í™•í•œ ì£¼ì†Œ
  newTag: 55-onprem

patches:
- patch: |-
    - op: replace
      path: /spec/replicas
      value: 2
  target:
    kind: Deployment
    name: frontend-deployment

- patch: |-
    - op: replace
      path: /spec/minReplicas
      value: 2
    - op: replace
      path: /spec/maxReplicas
      value: 3
  target:
    kind: HorizontalPodAutoscaler
    name: backend-hpa